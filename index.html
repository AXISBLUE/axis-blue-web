<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AXIS BLUE — Field Execution (Test)</title>
  <style>
    :root { --bg:#f6f6f6; --card:#ffffff; --ink:#111; --muted:#666; --line:#e6e6e6; --btn:#1f2937; --btn2:#374151; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--ink); }
    .wrap { max-width: 980px; margin: 28px auto; padding: 0 16px 40px; }
    h1 { margin: 0 0 6px; font-size: 34px; letter-spacing: -0.02em; }
    .sub { color: var(--muted); margin: 0 0 18px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 14px; }
    .card { background: var(--card); border: 1px solid var(--line); border-radius: 12px; padding: 16px; }
    .card h2 { margin: 0 0 10px; font-size: 18px; }
    .row { display: grid; grid-template-columns: 1fr; gap: 10px; }
    .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    label { font-size: 12px; color: var(--muted); display:block; margin-bottom:6px; }
    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 10px;
      font-size: 14px;
      background: #fff;
    }
    textarea { min-height: 90px; resize: vertical; }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    button {
      border: 0;
      background: var(--btn);
      color: #fff;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }
    button.secondary { background: var(--btn2); }
    button.ghost { background: transparent; color: var(--btn); border: 1px solid var(--line); }
    .pill { display:inline-block; padding: 4px 10px; border-radius: 999px; border: 1px solid var(--line); color: var(--muted); font-size: 12px; }
    .status { display:flex; gap: 10px; flex-wrap: wrap; align-items:center; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .log { margin-top: 10px; border-top: 1px dashed var(--line); padding-top: 12px; }
    .visit { padding: 10px 12px; border: 1px solid var(--line); border-radius: 10px; margin-bottom: 10px; background:#fafafa; }
    .visit h3 { margin: 0 0 6px; font-size: 14px; }
    .visit .meta { color: var(--muted); font-size: 12px; margin-bottom: 8px; }
    .kv { display:grid; grid-template-columns: 160px 1fr; gap: 6px 10px; font-size: 13px; }
    .kv b { color:#222; }
    .warn { color:#b45309; font-weight:700; }
    .ok { color:#047857; font-weight:700; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>AXIS BLUE — Web Online</h1>
    <p class="sub">Private test environment (<span class="mono" id="host"></span>)</p>

    <div class="card">
      <div class="status">
        <span class="pill">Session: <span id="sessionState" class="mono">loading…</span></span>
        <span class="pill">Active Visit: <span id="activeVisitState" class="mono">none</span></span>
        <button class="ghost" onclick="resetAll()">Reset local session</button>
      </div>
    </div>

    <div class="grid">

      <div class="card">
        <h2>Start Day</h2>
        <div class="row2">
          <div>
            <label>Merchandiser name</label>
            <input id="merchandiser" placeholder="Merchandiser name" />
          </div>
          <div>
            <label>Date</label>
            <input id="date" type="date" />
          </div>
        </div>
        <div class="btns">
          <button onclick="beginRoute()">Begin Route</button>
          <button class="secondary" onclick="saveHeaderOnly()">Save (no alerts)</button>
        </div>
      </div>

      <div class="card">
        <h2>Store Visit</h2>

        <div class="row2">
          <div>
            <label>Store</label>
            <select id="store"></select>
          </div>
          <div>
            <label>Urgent issue flag (separate + highlighted)</label>
            <select id="urgentFlag">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Sales opportunities (short bullets)</label>
            <textarea id="salesOpp" placeholder="- Endcap opportunity&#10;- Feature request&#10;- Missing signage"></textarea>
          </div>
          <div>
            <label>Inventory concerns / SKUs (short bullets, include SKU/UPC when possible)</label>
            <textarea id="inventoryConcerns" placeholder="- OOS: Pepsi 12pk 12oz (SKU ####)&#10;- Low: MTN DEW 20oz (UPC ####)"></textarea>
          </div>
          <div>
            <label>Questions / comments for PSR or MSR</label>
            <textarea id="repQuestions" placeholder="- Need approval for display move&#10;- Credits clarification needed"></textarea>
          </div>
        </div>

        <div class="btns">
          <button onclick="startVisit()">Start Visit</button>
          <button class="secondary" onclick="endVisit()">End Visit</button>
          <button class="ghost" onclick="clearVisitForm()">Clear form</button>
        </div>

        <div class="log">
          <div class="status">
            <span class="pill">Tip: hit <b>Start Visit</b> when you begin, fill notes during/after, then <b>End Visit</b>.</span>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Documents</h2>
        <div class="btns">
          <button onclick="downloadEVSForLast()">Download EVS TXT (last visit)</button>
          <button class="secondary" onclick="downloadEOD()">Download End-of-Day TXT</button>
          <button class="ghost" onclick="downloadJSON()">Download JSON backup</button>
        </div>
        <p class="sub" style="margin-top:10px;">
          PDFs + photos/PDR come next. For tomorrow, this gives you clean logs + exportables with zero backend dependency.
        </p>
      </div>

      <div class="card">
        <h2>Live Log</h2>
        <div id="liveLog"></div>
      </div>

    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
